name: CI

on:
  push:
    branches:
        - master
  pull_request:
    branches:
        - master

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  quality-checks:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        check: [lint, docs, format-check, type-check, test, validate-version]

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'
        cache-dependency-path: 'pyproject.toml'

    - name: Install dependencies
      run: pip install -e . --group dev

    - name: Run ${{ matrix.check }}
      if: matrix.check != 'validate-version' || github.event_name == 'pull_request'
      run: |
        case "${{ matrix.check }}" in
          lint|format-check|type-check|test|validate-version)
            ./scripts/ci/run_check.sh "${{ matrix.check }}"
            ;;
          *)
            echo "Unknown check type: ${{ matrix.check }}"
            exit 1
            ;;
        esac
